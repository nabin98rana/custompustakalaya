{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load ratings %}
{% load pustakalaya_filters %}
{% load hitcount_tags %}

<!-- override some css -->
{% block style %}
    {{ block.super }}
    <style>
        /* Some css to override styles */
        /* TODO: move this css to pustakalaya.css */
        .border-line {
            padding-top: 5px;
            padding-bottom: 5px !important;
            padding-left: 3px;
            border-top: 1px solid #dddddd;
        }

        .border-line span {
            display: inline-block;
            width: 300px;

        }

        #magazine{

      -webkit-transition:margin-left 0.2s ease-in-out;
      -moz-transition:margin-left 0.2s ease-in-out;
      -o-transition:margin-left 0.2s ease-in-out;
      -ms-transition:margin-left 0.2s ease-in-out;
      transition:margin-left 0.2s ease-in-out;
    }
    #magazine .turn-page{
      background-color:#ccc;
      background-size:100% 100%;
    }

    </style>
{% endblock style %}

{% block content %}
    <div>
        <div class="container min_height pt-4">
            <div class="row">

                <div class="col-md-3 col-sm-12  col-xs-12">
                    <!-- Logo -->
                    <img class="img-responsive rounded w-100" height="300px" src="{{ MEDIA_URL }}{{ object.thumbnail }}"
                         alt="{{ object.title }}" title="{{ object.title }}">
                    {% for document in object.documentfileupload_set.all %}

                        <a href="{{ MEDIA_URL }}{{ document.upload }}" role="button"
                           class="btn w-100 btn-primary btn-sm">Read: {{ document.file_name }}</a>

                        <!--Modal for flipping book-->
                        <!-- Button trigger modal -->
                        <!-- Large modal -->
                        <button class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg">Read
                        </button>


                         {# TODO: Calculate the file size and display in frontend #}
                    <p class="text-muted text-center">{%  trans "File size:" %}{{ document.upload.size | file_size_format}}</p>
                    {% endfor %}

                    <!-- show count -->
                    <p class="bg-blue text-dark text-center">Views:<span>&nbsp;{{ hitcount.total_hits }}</span></p>
                    <!-- Rating -->

                    {% ratings object %}
                    <!-- share buttons section -->
                    <section class="share-buttons text-center">
                        <a class="share-facebook p-1 btn btn-md bg-white"
                           href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}"
                           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden"><i class="fa fa-3x fa-facebook-square"
                                                    style="color: #2980b9 !important;"></i></span>
                        </a>
                        <a class="share-twitter p-1 btn btn-md bg-white text-primary"
                           href="http://twitter.com/share?text={{ article.title }}&url={{ request.build_absolute_uri|urlencode }}"
                           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden"> <i class="fa  fa-3x fa-twitter"></i></span>
                        </a>
                        <a class="share-google-plus p-1 btn btn-md bg-white"
                           href="https://plus.google.com/share?url={{ request.build_absolute_uri|urlencode }}"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden"> <i class="fa fa-3x fa-google-plus"
                                                     style="color:#c0392b !important;"></i></span>
                        </a>
                        <a class="share-linkedin p-1 btn btn-md bg-white" style="color: #2980b9; !important;"
                           href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.get_full_path|urlencode }}&title={{ object.title }}&summary={{ object.description }}&source={{ request.build_absolute_uri|urlencode }}"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span><i class="fa fa-3x fa-linkedin"></i></span>
                        </a>
                    </section>
                </div>


                <div class="col-md-9 col-sm-12 col-xs-12">
                    <!-- title of a document -->
                    <h4 class="text-capitalize h4 lead mt-0 pt-0 description text-dark">{{ object.title }}</h4>
                    <!-- author section -->
                    <div class="pb-1">
                        <!-- Authors -->
                        <!-- TODO pluralization -->
                        <!--strong class="text-capitalize font-weight-normal">{% trans "Authors:" %}</strong-->
                        {% for author in object.document_authors.all %}
                            <a href="{% url 'author:author_detail' author.getname|slugify author.pk %}"><span
                                    class="text-dark text-capitalize text-primary">
                                {{ author }}
                                {% if forloop.counter != object.document_authors.count %}|{% endif %}
                            </span></a>

                        {% endfor %}

                    </div>

                    <!-- Illustrator section -->
                    <div class="pb-1">
                        <!-- Authors -->
                        <!-- TODO pluralization -->
                        <!--strong class="text-capitalize font-weight-normal text-dark">{% trans "Illustrators:" %}</strong-->
                        {% for author in object.document_illustrators.all %}
                            <span class="text-dark text-capitalize">{{ illustrator }}</span>
                        {% endfor %}


                    </div>
                    <!-- abstract -->
                    <!-- abstract of a document -->
                    <div>

                        <span class="text-justify text-dark"
                                {% if not object.abstract %}
                              style="display: none"
                                {% endif %}>
                            {{ object.abstract }}</span>

                    </div>

                    <br>
                    <!-- Metadata section -->
                    <div class="row">
                        <!-- Left half section -->
                        <div class="col-md-12 col-sm-12 col-xs-12">

                            <!-- author section -->
                            <div class="pb-1 border-line"
                                    {% if not object.document_authors.all %}
                                 style="display: none;"
                                    {% endif %}>
                                <!-- Authors -->
                                <!-- TODO pluralization -->
                                <span class="capitalize font-weight-normal text-dark">{% trans "Authors:" %}</span>
                                {% for author in object.document_authors.all %}
                                    <span class="text-dark text-capitalize">{{ author }}</span>
                                {% endfor %}

                            </div>

                            <!-- Illustrator section -->
                            <div class="pb-1 border-line"
                                    {% if not object.document_illustrators.all %}
                                 style="display: none;"
                                    {% endif %}>
                                <!-- Authors -->
                                <!-- TODO pluralization -->
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "illustrators:" %}</span>
                                {% for illustrator in object.document_illustrators.all %}
                                    <span class="text-dark text-capitalize"> {{ illustrator }}</span>
                                {% endfor %}


                            </div>

                            <!-- editor section -->
                            <div class="pb-1 border-line">
                                <!-- Authors -->
                                <!-- TODO pluralization -->
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "Editors:" %}</span>
                                {% for editor in object.document_editors.all %}
                                    <span class="text-dark text-capitalize"> {{ editor }}</span>
                                {% endfor %}


                            </div>


                            <!-- publisher section -->
                            <div class="pb-1 border-line"
                                    {% if not object.publisher %}
                                 style="display: none;"
                                    {% endif %}>
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "Publisher:" %}</span>
                                <span class="text-dark text-capitalize"> {{ object.publisher }}</span>

                            </div>

                            <!-- place of publication -->
                            <div class="pb-1 border-line"
                                    {% if not object.place_of_publication %}
                                 style="display: none;"
                                    {% endif %}>
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "Place of publication:" %}</span>
                                <span class="text-dark text-capitalize"> {{ object.place_of_publication }}</span>

                            </div>


                            <!-- Publication year -->
                            <div class="pb-1 border-line"
                                    {% if not object.publication_year %}
                                 style="display: none;"
                                    {% endif %}>
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "publication year:" %}</span>
                                <span class="text-dark text-capitalize"> {{ object.publication_year }}</span>


                            </div>

                            <!-- Available year -->
                            <div class="pb-1 border-line"
                                    {% if not object.created_date %}
                                 style="display: none;"
                                    {% endif %}>

                                <span class="text-capitalize font-weight-normal text-dark">{% trans "available year:" %}</span>
                                <span class="text-dark text-capitalize"> {{ object.created_date }}</span>

                            </div>

                            <!-- Keywords -->
                            <div class="pb-1 border-line">

                                <!-- TODO pluralization -->
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "keywords:" %}</span>
                                {% for keyword in object.keywords.all %}

                                    <span class="text-dark text-capitalize"> <a

                                            href="{% url 'keyword:keyword_detail' keyword.keyword %}">{{ keyword.keyword| transtolocal }}</a></span>


                                {% endfor %}


                            </div>

                            <!-- Description -->
                            <div class="pb-1 border-line"
                                    {% if not object.description %}
                                 style="display: none"
                                    {% endif %}>
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "description:" %}</span>
                                <span class="text-dark text-capitalize"
                                      style="vertical-align: top;">{{ object.description }}</span>

                            </div>

                            <!-- License type -->
                            <div class="pb-1 border-line">
                                <!-- TODO pluralization -->
                                <span class="capitalize font-weight-normal text-dark">{% trans "License type:" %}</span>
                                <span class="text-dark text-capitalize"> {{ object.license_type }}</span>
                            </div>

                            <!-- document series -->
                            <div class="pb-1 border-line">
                                <!-- Add 2px right margin in each -->
                                <span class="capitalize font-weight-normal text-dark">{% trans "Series:" %}</span>
                                <span class="text-dark text-capitalize">{{ object.document_series }}</span>
                            </div>

                            <!-- document edition -->
                            <div class="pb-1 border-line"
                                    {% if not object.edition %}
                                 style="display: none;"
                                    {% endif %}>
                                <span class="capitalize text-dark text-capitalize">{% trans "edition:" %}</span>
                                <span class="text-dark">
                                    {{ object.edition }}
                                </span>
                            </div>

                            <!-- document volume -->
                            <div class="pb-1 border-line"
                                    {% if not object.volume %}
                                 style="display: none;"
                                    {% endif %}>
                                <span class="capitalize text-dark text-capitalize">{% trans "volume:" %}</span>
                                <span class="text-dark">{{ object.volume }}</span>
                            </div>

                            <!-- isbn -->
                            <!-- document isb -->
                            <div class="pb-1 border-line"
                                    {% if not object.documentidentifier.identifier_id %}
                                 style="display: none"
                                    {% endif %}>
                                <span class="capitalize text-dark text-capitalize">{{ object.documentidentifier.identifier_type }}:</span>
                                <span class="text-dark">{{ object.documentidentifier.identifier_id }}</span>
                            </div>

                            <!-- total page -->
                            <div class="pb-1 border-line"
                                    {% if not object.document_total_page %}
                                 style="display: none;"
                                    {% endif %}>
                                <!-- TODO: implement pluralization in total page -->
                                <span class="text-capitalize text-dark text-capitalize">{% trans "total pages" %}:</span>
                                <span class="text-dark"> {{ object.document_total_page }}</span>
                            </div>

                            <!-- Language -->
                            <div class="pb-1 border-line">
                                <!-- TODO: implement pluralization in total page -->
                                <span class="text-capitalize hidden text-dark text-capitalize">{% trans "languages" %}:</span>
                                {% for language in object.languages.all %}
                                    <span class="text-dark"> {{ language }}</span>
                                {% endfor %}
                            </div>

                            <!-- Education level -->
                            <div class="pb-1 border-line">
                                <!-- TODO: implement pluralization in total page -->
                                <span class="text-capitalize hidden text-dark text-capitalize">{% trans "education levels" %}:</span>
                                {% for education_level in object.education_levels.all %}
                                    <span class="text-dark"> {{ education_level }}</span>
                                {% endfor %}


                            </div>

                            <!-- Interactivity -->
                            <div class="pb-1 border-line">
                                <!-- TODO: implement pluralization in total page -->
                                <span class="text-capitalize hidden text-dark text-capitalize">{% trans "interactivity" %}:</span>
                                <span class="text-dark"> {{ object.document_interactivity }}</span>
                            </div>


                            <!-- Rights -->
                            <div class="pb-1 border-line" {% if not object.custom_license %} style="..." {% endif %}>
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "right:" %}</span>
                                <span class="text-dark text-capitalize"
                                      style="vertical-align: top;"> {{ object.custom_license }}</span>
                            </div>

                            <!-- sponsor -->
                            <div class="pb-1 border-line"
                                    {% if not object.sponsors.all %}
                                 style="display: none;"
                                    {% endif %}>
                                <!-- TODO pluralization -->
                                <span class="text-capitalize font-weight-normal text-dark">{% trans "sponsors:" %}</span>
                                {% for sponsor in object.sponsors.all %}
                                    <span class="text-dark text-capitalize"> {{ sponsor }}</span>
                                {% endfor %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        <!--modal large for flip book-->
        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <p class="text-primary">{{ object.title }}</p>
                <div class="modal-content">
                    <div id="magazine" style="margin: 0 auto;">

                        <div style="background-image:url('http://placehold.it/600x800');">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus accusantium animi beatae culpa eos impedit, modi, placeat quis recusandae repellat sed tempore. Autem consequatur ducimus molestias nobis quasi ut voluptates!</div>

                    {% comment %}
                        {% for img_url in ebook.get_files %}
                            <div style="background-image:url('{{ MEDIA_URL }}{{ img_url }}');"></div>
                        {% endfor %}
                    {% endcomment %}

                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
{% endblock content %}

{% block script %}
    {{ block.super }}
    <script src="http://www.turnjs.com/extras/modernizr.2.5.3.min.js" charset="utf-8"></script>
    <script src="http://www.turnjs.com/extras/jquery.mousewheel.min.js" charset="utf-8"></script>
    <script src="http://www.turnjs.com/samples/magazine/js/magazine.js" charset="utf-8"></script>
    <script type="text/javascript">

        function loadApp() {

            $('#all').fadeIn(1000);


            // Create the flipbook

            $('.magazine').turn({

                // Magazine width

                width: 922,

                // Magazine height

                height: 600,

                // Elevation will move the peeling corner this number of pixels by default

                elevation: 50,

                // Hardware acceleration

                acceleration: !isChrome(),

                // Enables gradients

                gradients: true,

                // Auto center this flipbook

                autoCenter: true,

                // The number of pages

                pages: 12,


                // Events
                when: {

                    turning: function (event, page, view) {

                        var book = $(this),
                            currentPage = book.turn('page'),
                            pages = book.turn('pages');

                        // Update the current URI

                        Hash.go('page/' + page).update();


                        // Show and hide navigation buttons

                        disableControls(page);


                        $('.thumbnails .page-' + currentPage).parent().removeClass('current');

                        $('.thumbnails .page-' + page).parent().addClass('current');

                    },

                    turned: function (event, page, view) {

                        disableControls(page);

                        $(this).turn('center');

                        if (page == 1) {
                            $(this).turn('peel', 'br');
                        }

                    },

                    missing: function (event, pages) {

                        // Add pages that aren't in the magazine

                        for (var i = 0; i < pages.length; i++)
                            addPage(pages[i], $(this));

                    }
                }

            });

            // Zoom.js

            $('.magazine-viewport').zoom({
                flipbook: $('.magazine'),
                max: function () {

                    return largeMagazineWidth() / $('.magazine').width();

                },
                when: {
                    tap: function (event) {

                        if ($(this).zoom('value') == 1) {
                            $('.magazine').removeClass('animated').addClass('zoom-in');
                            $(this).zoom('zoomIn', event);
                        } else {
                            $(this).zoom('zoomOut');
                        }
                    },

                    resize: function (event, scale, page, pageElement) {

                        if (scale == 1)
                            loadSmallPage(page, pageElement);
                        else
                            loadLargePage(page, pageElement);

                    },

                    zoomIn: function () {

                        $('.thumbnails').hide();
                        $('.made').hide();
                        $('.magazine').addClass('zoom-in');

                        if (!window.escTip && !$.isTouch) {
                            escTip = true;

                            $('<div />', {'class': 'esc'}).html('<div>Press ESC to exit</div>').appendTo($('body')).delay(2000).animate({opacity: 0}, 500, function () {
                                $(this).remove();
                            });
                        }
                    },

                    zoomOut: function () {

                        $('.esc').hide();
                        $('.thumbnails').fadeIn();
                        $('.made').fadeIn();

                        setTimeout(function () {
                            $('.magazine').addClass('animated').removeClass('zoom-in');
                            resizeViewport();
                        }, 0);

                    },

                    swipeLeft: function () {

                        $('.magazine').turn('next');

                    },

                    swipeRight: function () {

                        $('.magazine').turn('previous');

                    }
                }
            });

            // Using arrow keys to turn the page

            $(document).keydown(function (e) {

                var previous = 37, next = 39, esc = 27;

                switch (e.keyCode) {
                    case previous:

                        // left arrow
                        $('.magazine').turn('previous');
                        e.preventDefault();

                        break;
                    case next:

                        //right arrow
                        $('.magazine').turn('next');
                        e.preventDefault();

                        break;
                    case esc:

                        $('.magazine-viewport').zoom('zoomOut');
                        e.preventDefault();

                        break;
                }
            });

            // URIs - Format #/page/1

            Hash.on('^page\/([0-9]*)$', {
                yep: function (path, parts) {
                    var page = parts[1];

                    if (page !== undefined) {
                        if ($('.magazine').turn('is'))
                            $('.magazine').turn('page', page);
                    }

                },
                nop: function (path) {

                    if ($('.magazine').turn('is'))
                        $('.magazine').turn('page', 1);
                }
            });


            $(window).resize(function () {
                resizeViewport();
            }).bind('orientationchange', function () {
                resizeViewport();
            });

            // Events for thumbnails

            $('.thumbnails').click(function (event) {

                var page;

                if (event.target && (page = /page-([0-9]+)/.exec($(event.target).attr('class')))) {

                    $('.magazine').turn('page', page[1]);
                }
            });

            $('.thumbnails li').bind($.mouseEvents.over, function () {

                $(this).addClass('thumb-hover');

            }).bind($.mouseEvents.out, function () {

                $(this).removeClass('thumb-hover');

            });

            if ($.isTouch) {

                $('.thumbnails').addClass('thumbanils-touch').bind($.mouseEvents.move, function (event) {
                    event.preventDefault();
                });

            } else {

                $('.thumbnails ul').mouseover(function () {

                    $('.thumbnails').addClass('thumbnails-hover');

                }).mousedown(function () {

                    return false;

                }).mouseout(function () {

                    $('.thumbnails').removeClass('thumbnails-hover');

                });

            }


            // Regions

            if ($.isTouch) {
                $('.magazine').bind('touchstart', regionClick);
            } else {
                $('.magazine').click(regionClick);
            }

            // Events for the next button

            $('.next-button').bind($.mouseEvents.over, function () {

                $(this).addClass('next-button-hover');

            }).bind($.mouseEvents.out, function () {

                $(this).removeClass('next-button-hover');

            }).bind($.mouseEvents.down, function () {

                $(this).addClass('next-button-down');

            }).bind($.mouseEvents.up, function () {

                $(this).removeClass('next-button-down');

            }).click(function () {

                $('.magazine').turn('next');

            });

            // Events for the next button

            $('.previous-button').bind($.mouseEvents.over, function () {

                $(this).addClass('previous-button-hover');

            }).bind($.mouseEvents.out, function () {

                $(this).removeClass('previous-button-hover');

            }).bind($.mouseEvents.down, function () {

                $(this).addClass('previous-button-down');

            }).bind($.mouseEvents.up, function () {

                $(this).removeClass('previous-button-down');

            }).click(function () {

                $('.magazine').turn('previous');

            });


            resizeViewport();

            $('.magazine').addClass('animated');

        }


        $('#all').hide();


        // Load the HTML4 version if there's not CSS transform


    </script>

{% endblock script %}
